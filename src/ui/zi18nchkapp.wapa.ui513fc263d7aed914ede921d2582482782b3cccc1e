"use strict";                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
sap.ui.define(["./BaseController", "../model/formatter", "../model/models", "../model/dataAccess/rest/RepositoryInfoService", "../model/dataAccess/rest/CheckI18nService", "../model/util/AsyncDialog", "sap/base/Log", "sap/base/strings/formatMessage", "sap+
/m/MessageToast", "sap/ui/core/Fragment"], function (__BaseController, __formatter, __models, __RepositoryInfoService, __CheckI18nService, __AsyncDialog, Log, formatMessage, MessageToast, Fragment) {                                                        
  function _interopRequireDefault(obj) {                                                                                                                                                                                                                       
    return obj && obj.__esModule && typeof obj.default !== "undefined" ? obj.default : obj;                                                                                                                                                                    
  }                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
  const BaseController = _interopRequireDefault(__BaseController);                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
  const formatter = _interopRequireDefault(__formatter);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
  const models = _interopRequireDefault(__models);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
  const RepositoryInfoService = _interopRequireDefault(__RepositoryInfoService);                                                                                                                                                                               
                                                                                                                                                                                                                                                               
  const CheckI18nService = _interopRequireDefault(__CheckI18nService);                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
  const AsyncDialog = _interopRequireDefault(__AsyncDialog);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
  /**                                                                                                                                                                                                                                                          
   * Detail View Controller                                                                                                                                                                                                                                    
   *                                                                                                                                                                                                                                                           
   * @extends devepos.i18ncheck.controller.BaseController                                                                                                                                                                                                      
   * @alias devepos.i18ncheck.controller.Detail                                                                                                                                                                                                                
   * @public                                                                                                                                                                                                                                                   
   */                                                                                                                                                                                                                                                          
  const DetailController = BaseController.extend("devepos.i18ncheck.controller.Detail", {                                                                                                                                                                      
    constructor: function constructor() {                                                                                                                                                                                                                      
      BaseController.prototype.constructor.apply(this, arguments);                                                                                                                                                                                             
      this.formatter = formatter;                                                                                                                                                                                                                              
      this.formatMessage = formatMessage;                                                                                                                                                                                                                      
    },                                                                                                                                                                                                                                                         
    onInit: function _onInit() {                                                                                                                                                                                                                               
      BaseController.prototype.onInit.call(this);                                                                                                                                                                                                              
      this._oBundle = this.getOwnerComponent().getResourceBundle();                                                                                                                                                                                            
      this._oViewModel = models.createViewModel({                                                                                                                                                                                                              
        excludeActionEnabled: false,                                                                                                                                                                                                                           
        includeActionEnabled: false,                                                                                                                                                                                                                           
        busy: false                                                                                                                                                                                                                                            
      });                                                                                                                                                                                                                                                      
      this._oTable = this.byId("i18nMessages");                                                                                                                                                                                                                
      this.getView().setModel(this._oViewModel, "viewModel");                                                                                                                                                                                                  
      this.oRouter.getRoute("main").attachPatternMatched(this._onRouteMatched, this);                                                                                                                                                                          
      this.oRouter.getRoute("detail").attachPatternMatched(this._onRouteMatched, this);                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    onMessageTableSelectionChange: function _onMessageTableSelectionChange() {                                                                                                                                                                                 
      let bEnableExcludeAction = false;                                                                                                                                                                                                                        
      let bEnableIncludeAction = false;                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      for (const oSelectedContext of this._oTable.getSelectedContexts()) {                                                                                                                                                                                     
        if (oSelectedContext.getProperty("ignEntryUuid")) {                                                                                                                                                                                                    
          bEnableIncludeAction = true;                                                                                                                                                                                                                         
        } else {                                                                                                                                                                                                                                               
          bEnableExcludeAction = true;                                                                                                                                                                                                                         
        }                                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      this._oViewModel.setProperty("/excludeActionEnabled", bEnableExcludeAction);                                                                                                                                                                             
                                                                                                                                                                                                                                                               
      this._oViewModel.setProperty("/includeActionEnabled", bEnableIncludeAction);                                                                                                                                                                             
    },                                                                                                                                                                                                                                                         
    onAssignGitRepo: async function _onAssignGitRepo(oEvent) {                                                                                                                                                                                                 
      const oContext = this.getView().getBindingContext();                                                                                                                                                                                                     
      const oCurrentBsp = oContext === null || oContext === void 0 ? void 0 : oContext.getObject();                                                                                                                                                            
                                                                                                                                                                                                                                                               
      if (!oCurrentBsp) {                                                                                                                                                                                                                                      
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      const oDialogModel = models.createViewModel({                                                                                                                                                                                                            
        url: oCurrentBsp.gitUrl                                                                                                                                                                                                                                
      }); // show dialog                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
      const oDialog = new AsyncDialog({                                                                                                                                                                                                                        
        title: this._oBundle.getText("gitRepositoryAssignDialogTitle"),                                                                                                                                                                                        
        width: "45em",                                                                                                                                                                                                                                         
        height: "8em",                                                                                                                                                                                                                                         
        content: await Fragment.load({                                                                                                                                                                                                                         
          type: "XML",                                                                                                                                                                                                                                         
          name: "devepos.i18ncheck.fragment.ChangeGitRepo"                                                                                                                                                                                                     
        }),                                                                                                                                                                                                                                                    
        model: oDialogModel                                                                                                                                                                                                                                    
      });                                                                                                                                                                                                                                                      
      const sResult = await oDialog.showDialog(this.getView());                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
      if (sResult !== AsyncDialog.OK_BUTTON) {                                                                                                                                                                                                                 
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      const sGitUrl = oDialogModel.getProperty("/url");                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      if (sGitUrl === oCurrentBsp.gitUrl) {                                                                                                                                                                                                                    
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      try {                                                                                                                                                                                                                                                    
        const oRepoInfoService = new RepositoryInfoService();                                                                                                                                                                                                  
        await oRepoInfoService.updateRepoInfo({                                                                                                                                                                                                                
          bspName: oCurrentBsp.bspName,                                                                                                                                                                                                                        
          gitUrl: sGitUrl                                                                                                                                                                                                                                      
        });                                                                                                                                                                                                                                                    
        oContext.getModel().setProperty(`${oContext.sPath}/gitUrl`, sGitUrl);                                                                                                                                                                                  
        MessageToast.show(this._oBundle.getText("gitRepoUrlUpdated", oCurrentBsp.bspName));                                                                                                                                                                    
      } catch (oError) {                                                                                                                                                                                                                                       
        Log.error(oError);                                                                                                                                                                                                                                     
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    onExcludeMessages: async function _onExcludeMessages() {                                                                                                                                                                                                   
      this._createIgnoreMessageEntries(oObj => !oObj.ignEntryUuid, oObj => {                                                                                                                                                                                   
        return {                                                                                                                                                                                                                                               
          messageType: oObj.messageType,                                                                                                                                                                                                                       
          filePath: oObj.file.path,                                                                                                                                                                                                                            
          fileName: oObj.file.name,                                                                                                                                                                                                                            
          i18nKey: oObj.key                                                                                                                                                                                                                                    
        };                                                                                                                                                                                                                                                     
      }, this._updateIgnoreEntries.bind(this));                                                                                                                                                                                                                
    },                                                                                                                                                                                                                                                         
    onIncludeMessages: async function _onIncludeMessages() {                                                                                                                                                                                                   
      this._createIgnoreMessageEntries(oObj => !!oObj.ignEntryUuid, oObj => {                                                                                                                                                                                  
        return {                                                                                                                                                                                                                                               
          ignEntryUuid: oObj.ignEntryUuid                                                                                                                                                                                                                      
        };                                                                                                                                                                                                                                                     
      }, this._clearIgnoredKeyFromEntries.bind(this), true);                                                                                                                                                                                                   
    },                                                                                                                                                                                                                                                         
    onItemPress: function _onItemPress(oEvent) {},                                                                                                                                                                                                             
    onFullScreen: function _onFullScreen() {                                                                                                                                                                                                                   
      const sNextLayout = this.oLayoutModel.getProperty("/actionButtonsInfo/midColumn/fullScreen");                                                                                                                                                            
      this.getRouter().navTo("detail", {                                                                                                                                                                                                                       
        layout: sNextLayout,                                                                                                                                                                                                                                   
        resultPath: encodeURIComponent(this._sResultPath)                                                                                                                                                                                                      
      });                                                                                                                                                                                                                                                      
    },                                                                                                                                                                                                                                                         
    onExitFullScreen: function _onExitFullScreen() {                                                                                                                                                                                                           
      const sNextLayout = this.oLayoutModel.getProperty("/actionButtonsInfo/midColumn/exitFullScreen");                                                                                                                                                        
      this.getRouter().navTo("detail", {                                                                                                                                                                                                                       
        layout: sNextLayout,                                                                                                                                                                                                                                   
        resultPath: encodeURIComponent(this._sResultPath)                                                                                                                                                                                                      
      });                                                                                                                                                                                                                                                      
    },                                                                                                                                                                                                                                                         
    onClose: function _onClose() {                                                                                                                                                                                                                             
      var sNextLayout = this.oLayoutModel.getProperty("/actionButtonsInfo/midColumn/closeColumn");                                                                                                                                                             
      this.getRouter().navTo("main", {                                                                                                                                                                                                                         
        layout: sNextLayout                                                                                                                                                                                                                                    
      });                                                                                                                                                                                                                                                      
    },                                                                                                                                                                                                                                                         
    _onRouteMatched: function _onRouteMatched(oEvent) {                                                                                                                                                                                                        
      const sResultPath = decodeURIComponent(oEvent.getParameter("arguments").resultPath) || this._sResultPath || "";                                                                                                                                          
                                                                                                                                                                                                                                                               
      if (sResultPath) {                                                                                                                                                                                                                                       
        this._sResultPath = sResultPath;                                                                                                                                                                                                                       
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      this.getView().bindElement({                                                                                                                                                                                                                             
        path: sResultPath                                                                                                                                                                                                                                      
      });                                                                                                                                                                                                                                                      
    },                                                                                                                                                                                                                                                         
    _createIgnoreMessageEntries: async function _createIgnoreMessageEntries(fnFilterSelection, fnGetObject, fnResponsePostProcess, bDelete) {                                                                                                                  
      var _this$getView$getBind;                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      const aSelectedContexts = this._oTable.getSelectedContexts();                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
      if ((aSelectedContexts === null || aSelectedContexts === void 0 ? void 0 : aSelectedContexts.length) <= 0) {                                                                                                                                             
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      const oSelectedBsp = (_this$getView$getBind = this.getView().getBindingContext()) === null || _this$getView$getBind === void 0 ? void 0 : _this$getView$getBind.getObject();                                                                             
                                                                                                                                                                                                                                                               
      if (!oSelectedBsp) {                                                                                                                                                                                                                                     
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      this._oViewModel.setProperty("/busy", true);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
      const aIncludeExclude = [];                                                                                                                                                                                                                              
      const aRelevantSelections = [];                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
      for (const oContext of aSelectedContexts) {                                                                                                                                                                                                              
        const oContextObj = oContext.getObject();                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
        if (!fnFilterSelection(oContextObj)) {                                                                                                                                                                                                                 
          continue;                                                                                                                                                                                                                                            
        }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        aRelevantSelections.push(oContext);                                                                                                                                                                                                                    
        aIncludeExclude.push(Object.assign({                                                                                                                                                                                                                   
          bspName: oSelectedBsp.bspName                                                                                                                                                                                                                        
        }, fnGetObject(oContextObj)));                                                                                                                                                                                                                         
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      if (aIncludeExclude.length > 0) {                                                                                                                                                                                                                        
        try {                                                                                                                                                                                                                                                  
          var _oResponse$data;                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
          const oCheckService = new CheckI18nService();                                                                                                                                                                                                        
          const oResponse = bDelete ? await oCheckService.deleteIgnoredMessages(aIncludeExclude) : await oCheckService.ignoreMessages(aIncludeExclude);                                                                                                        
                                                                                                                                                                                                                                                               
          if ((oResponse === null || oResponse === void 0 ? void 0 : (_oResponse$data = oResponse.data) === null || _oResponse$data === void 0 ? void 0 : _oResponse$data.length) > 0) {                                                                       
            var _oResponse$data2;                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            fnResponsePostProcess(oResponse.data, aRelevantSelections);                                                                                                                                                                                        
            this.getOwnerComponent().getModel().updateBindings();                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            this._oTable.removeSelections();                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            const sTextKey = bDelete ? "messagesIncludedSuccess" : "messagesExcludedSuccess";                                                                                                                                                                  
            MessageToast.show(this._oBundle.getText(sTextKey, oResponse === null || oResponse === void 0 ? void 0 : (_oResponse$data2 = oResponse.data) === null || _oResponse$data2 === void 0 ? void 0 : _oResponse$data2.length));                          
          }                                                                                                                                                                                                                                                    
        } catch (oError) {                                                                                                                                                                                                                                     
          if (oError !== null && oError !== void 0 && oError.statusText) {                                                                                                                                                                                     
            Log.error(oError.statusText);                                                                                                                                                                                                                      
          } else {                                                                                                                                                                                                                                             
            Log.error(oError);                                                                                                                                                                                                                                 
          }                                                                                                                                                                                                                                                    
        }                                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      this._oViewModel.setProperty("/busy", false);                                                                                                                                                                                                            
    },                                                                                                                                                                                                                                                         
    _clearIgnoredKeyFromEntries: function _clearIgnoredKeyFromEntries(aResponseEntries, aContexts) {                                                                                                                                                           
      if ((aResponseEntries === null || aResponseEntries === void 0 ? void 0 : aResponseEntries.length) !== (aContexts === null || aContexts === void 0 ? void 0 : aContexts.length)) {                                                                        
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      for (const oContext of aContexts) {                                                                                                                                                                                                                      
        const oContextObj = oContext.getObject();                                                                                                                                                                                                              
        oContextObj.ignEntryUuid = "";                                                                                                                                                                                                                         
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    _updateIgnoreEntries: function _updateIgnoreEntries(aExcludedEntries, aContexts) {                                                                                                                                                                         
      if ((aExcludedEntries === null || aExcludedEntries === void 0 ? void 0 : aExcludedEntries.length) !== (aContexts === null || aContexts === void 0 ? void 0 : aContexts.length)) {                                                                        
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      for (const oSelectedContext of aContexts) {                                                                                                                                                                                                              
        const oSelectedObject = oSelectedContext.getObject(); // find the selected entry in the response                                                                                                                                                       
                                                                                                                                                                                                                                                               
        const oIgnoredEntry = aExcludedEntries.find(oEntry => oEntry.fileName === oSelectedObject.file.name && oEntry.filePath === oSelectedObject.file.path && oEntry.messageType === oSelectedObject.messageType && oEntry.i18nKey === oSelectedObject.key); 
                                                                                                                                                                                                                                                               
        if (oIgnoredEntry) {                                                                                                                                                                                                                                   
          oSelectedObject.ignEntryUuid = oIgnoredEntry.ignEntryUuid;                                                                                                                                                                                           
        }                                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
    }                                                                                                                                                                                                                                                          
  });                                                                                                                                                                                                                                                          
  return DetailController;                                                                                                                                                                                                                                     
});                                                                                                                                                                                                                                                            
//# sourceMappingURL=Detail.controller.js.map                                                                                                                                                                                                                  
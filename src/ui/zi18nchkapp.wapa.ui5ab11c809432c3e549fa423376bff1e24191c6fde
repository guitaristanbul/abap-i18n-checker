"use strict";                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
sap.ui.define(["./BaseController", "devepos/i18ncheck/model/models", "devepos/i18ncheck/model/dataAccess/rest/CheckI18nService", "devepos/i18ncheck/model/formatter", "sap/m/Token", "sap/ui/core/ValueState", "sap/base/Log", "sap/ui/model/Filter", "sap/m/M+
essageToast"], function (__BaseController, __models, __CheckI18nService, __formatter, Token, ValueState, Log, Filter, MessageToast) {                                                                                                                          
  function _interopRequireDefault(obj) {                                                                                                                                                                                                                       
    return obj && obj.__esModule && typeof obj.default !== "undefined" ? obj.default : obj;                                                                                                                                                                    
  }                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
  const BaseController = _interopRequireDefault(__BaseController);                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
  const models = _interopRequireDefault(__models);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
  const CheckI18nService = _interopRequireDefault(__CheckI18nService);                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
  const formatter = _interopRequireDefault(__formatter);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
  /**                                                                                                                                                                                                                                                          
   * Main View Controller                                                                                                                                                                                                                                      
   *                                                                                                                                                                                                                                                           
   * @extends devepos.i18ncheck.controller.BaseController                                                                                                                                                                                                      
   * @alias devepos.i18ncheck.controller.Main                                                                                                                                                                                                                  
   * @public                                                                                                                                                                                                                                                   
   */                                                                                                                                                                                                                                                          
  const MainController = BaseController.extend("devepos.i18ncheck.controller.Main", {                                                                                                                                                                          
    constructor: function constructor() {                                                                                                                                                                                                                      
      BaseController.prototype.constructor.apply(this, arguments);                                                                                                                                                                                             
      this.formatter = formatter;                                                                                                                                                                                                                              
    },                                                                                                                                                                                                                                                         
    onInit: function _onInit() {                                                                                                                                                                                                                               
      BaseController.prototype.onInit.call(this);                                                                                                                                                                                                              
      this._oPage = this.byId("page");                                                                                                                                                                                                                         
      this._oBundle = this.getOwnerComponent().getResourceBundle();                                                                                                                                                                                            
      this._oModel = this.getOwnerComponent().getModel();                                                                                                                                                                                                      
      this._oViewModel = models.createViewModel({                                                                                                                                                                                                              
        compareAgainstDefault: true,                                                                                                                                                                                                                           
        showExcludedEntries: false,                                                                                                                                                                                                                            
        defaultLanguage: "en",                                                                                                                                                                                                                                 
        selectedFilter: "Error",                                                                                                                                                                                                                               
        resultsTableTitle: this._oBundle.getText("resultsTableTitle", [0])                                                                                                                                                                                     
      });                                                                                                                                                                                                                                                      
      this.getView().setModel(this._oViewModel, "viewModel");                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
      this._oModel.setData({                                                                                                                                                                                                                                   
        count: 0,                                                                                                                                                                                                                                              
        withoutErrorsCount: 0,                                                                                                                                                                                                                                 
        withErrorsCount: 0                                                                                                                                                                                                                                     
      });                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
      this._oTargetLanguagesInput = this.getView().byId("trgtLanguagesInput");                                                                                                                                                                                 
      this._oBspNameFilterInput = this.getView().byId("bspNameFilter");                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    onUpdateFinished: function _onUpdateFinished() {                                                                                                                                                                                                           
      let iCount = 0;                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
      switch (this._oViewModel.getProperty("/selectedFilter")) {                                                                                                                                                                                               
        case "Error":                                                                                                                                                                                                                                          
          iCount = this._oModel.getProperty("/withErrorsCount");                                                                                                                                                                                               
          break;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        case "Ok":                                                                                                                                                                                                                                             
          iCount = this._oModel.getProperty("/withoutErrorsCount");                                                                                                                                                                                            
          break;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        case "All":                                                                                                                                                                                                                                            
          iCount = this._oModel.getProperty("/count");                                                                                                                                                                                                         
          break;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        default:                                                                                                                                                                                                                                               
          break;                                                                                                                                                                                                                                               
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      this._oViewModel.setProperty("/resultsTableTitle", this._oBundle.getText("resultsTableTitle", [iCount]));                                                                                                                                                
    },                                                                                                                                                                                                                                                         
    onResultsPress: function _onResultsPress(oEvent) {                                                                                                                                                                                                         
      const oNextUIState = this.getFlexColHelper().getNextUIState(1);                                                                                                                                                                                          
      this.oRouter.navTo("detail", {                                                                                                                                                                                                                           
        layout: oNextUIState.layout,                                                                                                                                                                                                                           
        resultPath: encodeURIComponent(oEvent.getSource().getBindingContextPath())                                                                                                                                                                             
      });                                                                                                                                                                                                                                                      
    },                                                                                                                                                                                                                                                         
    onChange: function _onChange(oEvent) {                                                                                                                                                                                                                     
      const oInput = oEvent.getSource();                                                                                                                                                                                                                       
      oInput.data("__changing", true);                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
      if (oInput.isA("sap.m.MultiInput")) {                                                                                                                                                                                                                    
        this._addTokensToMultiInput(oInput, oEvent === null || oEvent === void 0 ? void 0 : oEvent.getParameter("value"));                                                                                                                                     
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      if (oInput !== null && oInput !== void 0 && oInput.getRequired()) {                                                                                                                                                                                      
        this._checkRequired(oInput);                                                                                                                                                                                                                           
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    onSubmit: function _onSubmit(oEvent) {                                                                                                                                                                                                                     
      const oInput = oEvent.getSource();                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
      if (oInput.isA("sap.m.MultiInput")) {                                                                                                                                                                                                                    
        this._addTokensToMultiInput(oInput, oEvent.getParameter("value"));                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        if (oInput.data("__changing")) {                                                                                                                                                                                                                       
          oInput.data("__changing", false);                                                                                                                                                                                                                    
          return;                                                                                                                                                                                                                                              
        }                                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      this.onSearch();                                                                                                                                                                                                                                         
    },                                                                                                                                                                                                                                                         
    onSearch: async function _onSearch() {                                                                                                                                                                                                                     
      if (!this._validateFields()) {                                                                                                                                                                                                                           
        return;                                                                                                                                                                                                                                                
      } // this.getOwnerComponent().getModel().setData();                                                                                                                                                                                                      
      // check if the results model is filled, if so nothing has to be done                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      this._oViewModel.setProperty("/busy", true);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
      const oModelData = this._oViewModel.getData();                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
      const mParams = {                                                                                                                                                                                                                                        
        defaultLanguage: oModelData.defaultLanguage,                                                                                                                                                                                                           
        compareAgainstDefaultFile: oModelData.compareAgainstDefault,                                                                                                                                                                                           
        targetLanguages: this._oTargetLanguagesInput.getTokens().map(oToken => oToken.getKey()).join(","),                                                                                                                                                     
        bspNames: this._oBspNameFilterInput.getTokens().map(oToken => encodeURIComponent(oToken.getKey())).join(","),                                                                                                                                          
        showExcludedEntries: oModelData.showExcludedEntries                                                                                                                                                                                                    
      };                                                                                                                                                                                                                                                       
      let aCheckResults = [];                                                                                                                                                                                                                                  
      let iWithErrorsCount = 0;                                                                                                                                                                                                                                
      let iWithoutErrorsCount = 0;                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
      try {                                                                                                                                                                                                                                                    
        const oCheckService = new CheckI18nService();                                                                                                                                                                                                          
        const oResponse = await oCheckService.checkTranslations(mParams);                                                                                                                                                                                      
        aCheckResults = oResponse.data;                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
        for (const oCheckResult of aCheckResults) {                                                                                                                                                                                                            
          switch (oCheckResult.status) {                                                                                                                                                                                                                       
            case "S":                                                                                                                                                                                                                                          
            case "W":                                                                                                                                                                                                                                          
              iWithoutErrorsCount++;                                                                                                                                                                                                                           
              break;                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
            case "E":                                                                                                                                                                                                                                          
              iWithErrorsCount++;                                                                                                                                                                                                                              
              break;                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
            default:                                                                                                                                                                                                                                           
              break;                                                                                                                                                                                                                                           
          }                                                                                                                                                                                                                                                    
        }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        if (!aCheckResults || aCheckResults.length === 0) {                                                                                                                                                                                                    
          MessageToast.show(this._oBundle.getText("noDataFoundMessage"));                                                                                                                                                                                      
        }                                                                                                                                                                                                                                                      
      } catch (oError) {                                                                                                                                                                                                                                       
        const sErrorMessage = oError.statusText ? oError.statusText : "Error during calling the 'check i18n translations' service";                                                                                                                            
        Log.error(sErrorMessage);                                                                                                                                                                                                                              
        MessageToast.show(sErrorMessage);                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      this._oModel.setData({                                                                                                                                                                                                                                   
        results: aCheckResults,                                                                                                                                                                                                                                
        count: aCheckResults.length,                                                                                                                                                                                                                           
        withoutErrorsCount: iWithoutErrorsCount,                                                                                                                                                                                                               
        withErrorsCount: iWithErrorsCount                                                                                                                                                                                                                      
      });                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
      this._oViewModel.setProperty("/busy", false);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
      this.onFilterChange();                                                                                                                                                                                                                                   
    },                                                                                                                                                                                                                                                         
    onFilterChange: function _onFilterChange(oEvent) {                                                                                                                                                                                                         
      const oBinding = this.byId("checkResults").getBinding("items");                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
      const sFilterKey = this._oViewModel.getProperty("/selectedFilter"); // Array to combine filters                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      const aFilters = [];                                                                                                                                                                                                                                     
      let oStatusFilter;                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
      if (sFilterKey === "Ok") {                                                                                                                                                                                                                               
        oStatusFilter = new Filter("status", "NE", "E");                                                                                                                                                                                                       
      } else if (sFilterKey === "Error") {                                                                                                                                                                                                                     
        oStatusFilter = new Filter("status", "EQ", "E");                                                                                                                                                                                                       
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      if (oStatusFilter) {                                                                                                                                                                                                                                     
        aFilters.push(oStatusFilter);                                                                                                                                                                                                                          
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      oBinding.filter(aFilters);                                                                                                                                                                                                                               
    },                                                                                                                                                                                                                                                         
    _addTokensToMultiInput: function _addTokensToMultiInput(oInput, sValue) {                                                                                                                                                                                  
      var _oInput$data;                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      if (!oInput || !(oInput !== null && oInput !== void 0 && oInput.isA("sap.m.MultiInput")) || !sValue) {                                                                                                                                                   
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      if ((_oInput$data = oInput.data()) !== null && _oInput$data !== void 0 && _oInput$data.hasOwnProperty("upperCase")) {                                                                                                                                    
        var _sValue;                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
        if (oInput.data().upperCase && (_sValue = sValue) !== null && _sValue !== void 0 && _sValue.toUpperCase) {                                                                                                                                             
          sValue = sValue.toUpperCase();                                                                                                                                                                                                                       
        }                                                                                                                                                                                                                                                      
      } // check if token was already added                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
      const aTokens = oInput.getTokens();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
      if (aTokens.filter(oToken => oToken.getKey() === sValue).length <= 0) {                                                                                                                                                                                  
        oInput.addToken(new Token({                                                                                                                                                                                                                            
          key: sValue,                                                                                                                                                                                                                                         
          text: sValue                                                                                                                                                                                                                                         
        }));                                                                                                                                                                                                                                                   
        oInput.setValue("");                                                                                                                                                                                                                                   
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    _checkRequired: function _checkRequired(oInputCtrl) {                                                                                                                                                                                                      
      let bSetValueState = false;                                                                                                                                                                                                                              
      let sValueState = "";                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
      if (oInputCtrl.isA("sap.m.MultiInput")) {                                                                                                                                                                                                                
        const aTokens = oInputCtrl.getTokens();                                                                                                                                                                                                                
        bSetValueState = true;                                                                                                                                                                                                                                 
        sValueState = !aTokens || aTokens.length <= 0 ? ValueState.Error : ValueState.None;                                                                                                                                                                    
        oInputCtrl.setValueState();                                                                                                                                                                                                                            
      } else if (oInputCtrl.isA("sap.m.Input")) {                                                                                                                                                                                                              
        bSetValueState = true;                                                                                                                                                                                                                                 
        sValueState = !oInputCtrl.getValue() ? ValueState.Error : ValueState.None;                                                                                                                                                                             
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      if (bSetValueState) {                                                                                                                                                                                                                                    
        oInputCtrl.setValueState(sValueState);                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
        if (sValueState === ValueState.Error) {                                                                                                                                                                                                                
          oInputCtrl.setValueStateText(this.getOwnerComponent().getResourceBundle().getText("mandatoryFieldNotFilled"));                                                                                                                                       
        } else {                                                                                                                                                                                                                                               
          oInputCtrl.setValueStateText("");                                                                                                                                                                                                                    
        }                                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    _validateFields: function _validateFields() {                                                                                                                                                                                                              
      const aRequired = this.getView().getControlsByFieldGroupId("requiredParam");                                                                                                                                                                             
                                                                                                                                                                                                                                                               
      for (const oRequiredCtrl of aRequired) {                                                                                                                                                                                                                 
        if (!oRequiredCtrl.getRequired) {                                                                                                                                                                                                                      
          continue;                                                                                                                                                                                                                                            
        }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        this._checkRequired(oRequiredCtrl);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
        if (oRequiredCtrl !== null && oRequiredCtrl !== void 0 && oRequiredCtrl.getRequired() && (oRequiredCtrl === null || oRequiredCtrl === void 0 ? void 0 : oRequiredCtrl.getValueState()) === ValueState.Error) {                                         
          setTimeout(() => {                                                                                                                                                                                                                                   
            oRequiredCtrl.focus();                                                                                                                                                                                                                             
          }, 100);                                                                                                                                                                                                                                             
          return false;                                                                                                                                                                                                                                        
        }                                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      return true;                                                                                                                                                                                                                                             
    }                                                                                                                                                                                                                                                          
  });                                                                                                                                                                                                                                                          
  return MainController;                                                                                                                                                                                                                                       
});                                                                                                                                                                                                                                                            
//# sourceMappingURL=Main.controller.js.map                                                                                                                                                                                                                    